<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mosquito-mediated epidemiological effects of malarone treatment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="malarone_files/libs/clipboard/clipboard.min.js"></script>
<script src="malarone_files/libs/quarto-html/quarto.js"></script>
<script src="malarone_files/libs/quarto-html/popper.min.js"></script>
<script src="malarone_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="malarone_files/libs/quarto-html/anchor.min.js"></script>
<link href="malarone_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="malarone_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="malarone_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="malarone_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="malarone_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#parameters" id="toc-parameters" class="nav-link active" data-scroll-target="#parameters"><span class="header-section-number">1</span> Parameters</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages"><span class="header-section-number">2</span> Packages</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions"><span class="header-section-number">3</span> Functions</a></li>
  <li><a href="#theoretical-results" id="toc-theoretical-results" class="nav-link" data-scroll-target="#theoretical-results"><span class="header-section-number">4</span> Theoretical results</a></li>
  <li><a href="#experimental-data" id="toc-experimental-data" class="nav-link" data-scroll-target="#experimental-data"><span class="header-section-number">5</span> Experimental data</a>
  <ul class="collapse">
  <li><a href="#mosquitoes-with-sporozoites" id="toc-mosquitoes-with-sporozoites" class="nav-link" data-scroll-target="#mosquitoes-with-sporozoites"><span class="header-section-number">5.1</span> Mosquitoes with sporozoites</a></li>
  <li><a href="#number-of-sporozoites" id="toc-number-of-sporozoites" class="nav-link" data-scroll-target="#number-of-sporozoites"><span class="header-section-number">5.2</span> Number of sporozoites</a></li>
  <li><a href="#sizes-of-oocysts-at-7dpi" id="toc-sizes-of-oocysts-at-7dpi" class="nav-link" data-scroll-target="#sizes-of-oocysts-at-7dpi"><span class="header-section-number">5.3</span> Sizes of oocysts at 7dpi</a></li>
  <li><a href="#combining-the-3-effects" id="toc-combining-the-3-effects" class="nav-link" data-scroll-target="#combining-the-3-effects"><span class="header-section-number">5.4</span> Combining the 3 effects</a></li>
  </ul></li>
  <li><a href="#epidemiological-effects-of-malarone" id="toc-epidemiological-effects-of-malarone" class="nav-link" data-scroll-target="#epidemiological-effects-of-malarone"><span class="header-section-number">6</span> Epidemiological effects of malarone</a>
  <ul class="collapse">
  <li><a href="#mass-treatment" id="toc-mass-treatment" class="nav-link" data-scroll-target="#mass-treatment"><span class="header-section-number">6.1</span> Mass treatment</a></li>
  <li><a href="#treatment-of-infected" id="toc-treatment-of-infected" class="nav-link" data-scroll-target="#treatment-of-infected"><span class="header-section-number">6.2</span> Treatment of infected</a></li>
  </ul></li>
  <li><a href="#numerical-analysis" id="toc-numerical-analysis" class="nav-link" data-scroll-target="#numerical-analysis"><span class="header-section-number">7</span> Numerical analysis</a>
  <ul class="collapse">
  <li><a href="#reducing-factor-deltat" id="toc-reducing-factor-deltat" class="nav-link" data-scroll-target="#reducing-factor-deltat"><span class="header-section-number">7.1</span> Reducing factor <span class="math inline">\(\delta(t)\)</span></a></li>
  <li><a href="#mass-treatment-1" id="toc-mass-treatment-1" class="nav-link" data-scroll-target="#mass-treatment-1"><span class="header-section-number">7.2</span> Mass treatment</a></li>
  <li><a href="#treatment-of-infected-1" id="toc-treatment-of-infected-1" class="nav-link" data-scroll-target="#treatment-of-infected-1"><span class="header-section-number">7.3</span> Treatment of infected</a></li>
  <li><a href="#examples-with-r_0" id="toc-examples-with-r_0" class="nav-link" data-scroll-target="#examples-with-r_0"><span class="header-section-number">7.4</span> Examples with <span class="math inline">\(R_0\)</span></a></li>
  <li><a href="#main-text-figure" id="toc-main-text-figure" class="nav-link" data-scroll-target="#main-text-figure"><span class="header-section-number">7.5</span> Main text figure</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mosquito-mediated epidemiological effects of malarone treatment</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this analysis we use the formalism of <span class="citation" data-cites="smith_statics_2004">Smith and McKenzie (<a href="#ref-smith_statics_2004" role="doc-biblioref">2004</a>)</span>.</p>
<section id="parameters" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="parameters"><span class="header-section-number">1</span> Parameters</h2>
<p>The path to the data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>path2data <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">"HOME"</span>), <span class="st">"/Library/CloudStorage/"</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"OneDrive-OxfordUniversityClinicalResearchUnit/"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"GitHub/choisy/malarone/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Whether or not to force the effects to be equal to <span class="math inline">\(0\)</span> at <span class="math inline">\(t = 28\)</span> days (in practice it does not change things much anyway):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>t28_0 <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Colors:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>YlOrRd10 <span class="ot">&lt;-</span> <span class="fu">hcl.colors</span>(<span class="dv">10</span>, <span class="st">"YlOrRd"</span>, <span class="at">rev =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>YlOrRd11 <span class="ot">&lt;-</span> <span class="fu">hcl.colors</span>(<span class="dv">11</span>, <span class="st">"YlOrRd"</span>, <span class="at">rev =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>color1 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>color2 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>color3 <span class="ot">&lt;-</span> <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Line width:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>lwd_val <span class="ot">&lt;-</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot labels:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>xlab_pda <span class="ot">&lt;-</span> <span class="st">"time post drug administration (hours)"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ylab_delta <span class="ot">&lt;-</span> <span class="fu">bquote</span>(R[<span class="dv">0</span>] <span class="sc">~</span> <span class="st">"reduction factor"</span> <span class="sc">~</span> delta)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ylab_pi <span class="ot">&lt;-</span> <span class="fu">bquote</span>(R[<span class="dv">0</span>] <span class="sc">~</span> <span class="st">"reduction factor"</span> <span class="sc">~</span> pi)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>ylab_rho <span class="ot">&lt;-</span> <span class="fu">bquote</span>(R[<span class="dv">0</span>] <span class="sc">~</span> <span class="st">"reduction factor"</span> <span class="sc">~</span> rho)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>ylab_b <span class="ot">&lt;-</span> <span class="fu">bquote</span>(<span class="st">"reducing factor on b and"</span> <span class="sc">~</span> R[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plots parameters sets:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mcx <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>parmfrow33 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="at">mex =</span> mcx, <span class="at">cex.axis =</span> mcx, <span class="at">cex.lab =</span> mcx, <span class="at">cex.main =</span> mcx)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="packages" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="packages"><span class="header-section-number">2</span> Packages</h2>
<p>Required packages:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"readr"</span>, <span class="st">"readxl"</span>, <span class="st">"dplyr"</span>, <span class="st">"purrr"</span>, <span class="st">"stringr"</span>, <span class="st">"tibble"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Installing those that are not installed:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>to_inst <span class="ot">&lt;-</span> required_packages[<span class="sc">!</span> required_packages <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="st">"Package"</span>]]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(to_inst)) <span class="fu">install.packages</span>(to_inst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Loading some for interactive use:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="functions" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="functions"><span class="header-section-number">3</span> Functions</h2>
<p>Tuning some base functions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>seq2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">seq</span>(..., <span class="at">le =</span> <span class="dv">512</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>abline2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">abline</span>(..., <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>lines2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">lines</span>(..., <span class="at">lwd =</span> lwd_val)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>lines3 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">lines2</span>(..., <span class="at">col =</span> color1)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>segments2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">segments</span>(..., <span class="at">col =</span> color3, <span class="at">lwd =</span> lwd_val)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">plot</span>(..., <span class="at">col =</span> color3, <span class="at">pch =</span> <span class="dv">3</span>, <span class="at">lwd =</span> lwd_val)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>plotl <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">plot</span>(..., <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> color1, <span class="at">lwd =</span> lwd_val)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>arrows2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">arrows</span>(..., <span class="at">col =</span> color2, <span class="at">length =</span> .<span class="dv">15</span>, <span class="at">lwd =</span> lwd_val)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>readRDS2 <span class="ot">&lt;-</span> <span class="cf">function</span>(f, ...) tibble<span class="sc">::</span><span class="fu">as_tibble</span>(<span class="fu">readRDS</span>(<span class="fu">paste0</span>(path2data, f), ...))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>legend2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">legend</span>(<span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> lwd_val, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A function that performs numerical integration using the trapezoid method:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>trapezoid <span class="ot">&lt;-</span> <span class="cf">function</span>(f, lower, upper, <span class="at">nb =</span> <span class="fl">1e4</span>) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  step <span class="ot">&lt;-</span> (upper <span class="sc">-</span> lower) <span class="sc">/</span> nb</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">f</span>(<span class="fu">seq</span>(lower, upper, <span class="at">le =</span> nb <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  step <span class="sc">*</span> (y[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(y[<span class="sc">-</span><span class="dv">1</span>])) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A function that replaces the value at index <code>i</code> in a vector <code>v</code> by the minimum of the values of <code>v</code> with an index equal or higher than <code>i</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>min_of_following <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">min</span>(x), <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(x) <span class="sc">-</span> <span class="dv">1</span>), <span class="sc">~</span> <span class="fu">min</span>(x[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>(.x))])))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="theoretical-results" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="theoretical-results"><span class="header-section-number">4</span> Theoretical results</h2>
<p>In this section we pull out the most relevant theoretical results from <span class="citation" data-cites="smith_statics_2004">Smith and McKenzie (<a href="#ref-smith_statics_2004" role="doc-biblioref">2004</a>)</span>.</p>
<p>The <strong>individual vectorial capacity</strong> (noted <span class="math inline">\(IC\)</span> in <span class="citation" data-cites="smith_statics_2004">Smith and McKenzie (<a href="#ref-smith_statics_2004" role="doc-biblioref">2004</a>)</span> but noted <span class="math inline">\(C\)</span> here) is defined by <span class="citation" data-cites="saul_cyclical_1990">Saul et al. (<a href="#ref-saul_cyclical_1990" role="doc-biblioref">1990</a>)</span> as the expected number of infectious bites from a single vector after feeding on an infectious host and reads:</p>
<p><span class="math display">\[
C = c \cdot P_e \cdot S
\]</span></p>
<p>where <span class="math inline">\(c\)</span> is the <strong>transmission efficiency from human to mosquito</strong> (<em>i.e.</em> the probability of becoming infected after feeding on an infectious human), <span class="math inline">\(P_e\)</span> is the <strong>probability of becoming infectious for an infected mosquito</strong>:</p>
<p><span class="math display">\[
P_e = e^{-gn}
\]</span> (with <span class="math inline">\(g\)</span> the <strong>mosquito death rate</strong> and <span class="math inline">\(n\)</span> the <strong>EIP</strong>), and <span class="math inline">\(S\)</span> is the <strong>stability index</strong>, <em>i.e.</em> the total number of bites per mosquito during its lifetime:</p>
<p><span class="math display">\[
S = \frac{a}{g}
\]</span></p>
<p>with <span class="math inline">\(a\)</span> the <strong>mosquito biting rate</strong>, <em>i.e.</em> the number of bites per mosquito. Gathering everything gives:</p>
<p><span class="math display">\[
C = c \cdot e^{-gn}\frac{a}{g}
\]</span></p>
<p>The <strong>basic reproduction ratio</strong> is the expected number of infected humans per infected human or, equivalently, the expected number of infected mosquitoes per infected mosquito and can be expressed as:</p>
<p><span id="eq-R0"><span class="math display">\[
R_0 = \frac{C \cdot b \cdot a \cdot m}{r}
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(C\)</span> is the above-defined individual vectorial capacity, <span class="math inline">\(b\)</span> is the <strong>transmission efficiency from mosquito to human</strong>, <span class="math inline">\(r\)</span> is the <strong>recovery rate of humans</strong>, and <span class="math inline">\(m\)</span> is the <strong>ratio of mosquitoes to humans</strong>.</p>
<p>Finally, the <strong>prevalance</strong> <span class="math inline">\(\bar{X}\)</span> (<em>i.e.</em> proportion of infected humans) at equilibrium can be expressed as a function of <span class="math inline">\(R_0\)</span>:</p>
<p><span class="math display">\[
\bar{X} = \frac{R_0 - 1}{R_0 + c S}
\]</span></p>
<p>Note the main assumption of this framework:</p>
<p><strong>Assumption 1:</strong> the mosquito death rate is independent of the mosquito’s age.</p>
</section>
<section id="experimental-data" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="experimental-data"><span class="header-section-number">5</span> Experimental data</h2>
<p>The experimental results suggest that malarone</p>
<ol type="1">
<li>decreases by the multiplicative factor <span class="math inline">\(1 - \alpha\)</span> (<span class="math inline">\(0 \leq \alpha \leq 1\)</span>) the number of mosquitoes with sporozoites (with <span class="math inline">\(\alpha\)</span> shown on the <span class="math inline">\(y\)</span> axis of Figure 3B);</li>
<li>decreases by the multiplicative factor <span class="math inline">\(1 - \beta\)</span> (<span class="math inline">\(0 \leq \beta \leq 1\)</span>) the sporozoites load in mosquitoes still harboring sporozoites (with <span class="math inline">\(\beta\)</span> shown on the <span class="math inline">\(y\)</span> axis of Figure 4B);</li>
<li>decreases by the multiplicative factor <span class="math inline">\(1 - \gamma\)</span> (<span class="math inline">\(0 \leq \gamma \leq 1\)</span>) the size of oocysts at 7 days post infection (with <span class="math inline">\(\gamma\)</span> shown on the <span class="math inline">\(y\)</span> axis of Figure 5A);</li>
<li>has no effect on the mosquito biting rate <span class="math inline">\(a\)</span> (Figure 7A);</li>
<li>has no effect on the mosquito death rate <span class="math inline">\(g\)</span> (Figure 7B).</li>
</ol>
<p>Let’s see below how we can integrate these 3 effects <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span> into the theoretical equations of the previous section.</p>
<section id="mosquitoes-with-sporozoites" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="mosquitoes-with-sporozoites"><span class="header-section-number">5.1</span> Mosquitoes with sporozoites</h3>
<p>Below, we generate the function <span class="math inline">\(\alpha(t)\)</span> from the experimental data of Figure 3B. First we need a function that reads experimental data for the treatment group:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>make_reading_exp_data <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  hours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">48</span>, <span class="dv">72</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  days <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">28</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  hash <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">setNames</span>(hours, <span class="fu">paste0</span>(<span class="st">"H"</span>, hours)),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">setNames</span>(<span class="dv">24</span> <span class="sc">*</span> days, <span class="fu">paste0</span>(<span class="st">"D"</span>, days)))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(file) {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    file <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">readRDS2</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(treatment <span class="sc">==</span> <span class="st">"AL+AP"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">time_hours =</span> hash[stringr<span class="sc">::</span><span class="fu">str_remove</span>(time_points, <span class="st">"0"</span>)],</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>             <span class="fu">across</span>(Inhibition, <span class="sc">~</span> .x <span class="sc">/</span> <span class="dv">100</span>))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>reading_exp_data <span class="ot">&lt;-</span> <span class="fu">make_reading_exp_data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also need a function that converts such experimental data into a function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data2function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">correction =</span> t28_0) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  apply_correction <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (correction) <span class="fu">return</span>(<span class="fu">mutate</span>(x, <span class="at">median_val =</span> <span class="fu">c</span>(<span class="fu">head</span>(median_val, <span class="sc">-</span><span class="dv">1</span>), <span class="dv">0</span>)))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(time_hours) <span class="sc">|&gt;</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">median_val =</span> <span class="fu">max</span>(<span class="dv">0</span>, <span class="fu">median</span>(Inhibition))) <span class="sc">|&gt;</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">time_hours =</span> <span class="dv">0</span>, <span class="at">median_val =</span> <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(time_hours) <span class="sc">|&gt;</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply_correction</span>() <span class="sc">|&gt;</span> </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with</span>(<span class="fu">approxfun</span>(time_hours, median_val))</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where <code>correction = TRUE</code> means that the value at <span class="math inline">\(t = 28\)</span> days is forced to be equal to <span class="math inline">\(0\)</span>. Let’s now pull out the data from Figure 3B:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>alpha_data <span class="ot">&lt;-</span> <span class="fu">reading_exp_data</span>(<span class="st">"percentage_inhibition9.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and create a function <code>alpha()</code> of the percentage <span class="math inline">\(\alpha(t)\)</span> inhibition on sporozoite infection rate as a function of time <span class="math inline">\(t\)</span> post drug administration:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">data2function</span>(alpha_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now visualize this function. For that we first need a function that plots experimental data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plot_experimental_data <span class="ot">&lt;-</span> <span class="cf">function</span>(data, ...) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(data, <span class="fu">plot2</span>(<span class="fu">jitter</span>(time_hours), Inhibition, <span class="at">xlab =</span> xlab_pda, ...))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With this function <code>plot_experimental_data()</code> defined, this is what the <span class="math inline">\(\alpha(t)\)</span> function coded in <code>alpha()</code> looks like together with the experimental data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_experimental_data</span>(alpha_data, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ylab =</span> <span class="fu">bquote</span>(<span class="st">"reduction"</span> <span class="sc">~</span> alpha <span class="sc">~</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"of mosquitoes with sporozoites"</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>pda_t <span class="ot">&lt;-</span> <span class="fu">seq2</span>(<span class="dv">0</span>, <span class="dv">700</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines3</span>(pda_t, <span class="fu">alpha</span>(pda_t))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
<p>The reduction factor <span class="math inline">\(1 - \alpha\)</span> of the number of mosquitoes with sporozoites (Figure 3B) converts directly into a transmission-blocking activity (TBA) of similar magnitude on the mean individual vectorial capacity:</p>
<p><span class="math display">\[
(1 - \alpha(t))\cdot C
\]</span></p>
<p>where <span class="math inline">\(C\)</span> is the vectorial capacity in absence of malarone and <span class="math inline">\(t\)</span> is the time post drug administration. Similarly, <a href="#eq-R0" class="quarto-xref">Equation&nbsp;1</a> shows that the reduction of <span class="math inline">\(R_0\)</span> is</p>
<p><span class="math display">\[
(1 - \alpha(t))\cdot R_0
\]</span></p>
<p>where <span class="math inline">\(R_0\)</span> is the basic reproduction ratio in absence of malarone.</p>
</section>
<section id="number-of-sporozoites" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="number-of-sporozoites"><span class="header-section-number">5.2</span> Number of sporozoites</h3>
<p>Let’s pull out the data from Figure 4B:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>beta_data <span class="ot">&lt;-</span> <span class="fu">reading_exp_data</span>(<span class="st">"newTRA.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and create a function <code>beta(t)</code> on the percentage <span class="math inline">\(\beta(t)\)</span> inhibition on sporozoite load as a function of time <span class="math inline">\(t\)</span> post drug administration:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">data2function</span>(beta_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And let’s visualize this function <span class="math inline">\(\beta(t)\)</span> together with the experimental data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_experimental_data</span>(beta_data, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ylab =</span> <span class="fu">bquote</span>(<span class="st">"reduction"</span> <span class="sc">~</span> beta <span class="sc">~</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"of the number L of sporozoites"</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">beta</span>(pda_t)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines3</span>(pda_t, betas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-beta_data" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-beta_data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="malarone_files/figure-html/fig-beta_data-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-beta_data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: experimental data and model from Figure 4B.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The integration of the <span class="math inline">\(\beta\)</span> effect into <a href="#eq-R0" class="quarto-xref">Equation&nbsp;1</a> is less direct and straight-forward than for <span class="math inline">\(\alpha\)</span>. To do so, we need to understand how a reduction in the sporozoite load <span class="math inline">\(L\)</span> translates into a reduction of <span class="math inline">\(b\)</span> in <a href="#eq-R0" class="quarto-xref">Equation&nbsp;1</a>. Figure 2B from <span class="citation" data-cites="aleshnick_experimental_2020">Aleshnick et al. (<a href="#ref-aleshnick_experimental_2020" role="doc-biblioref">2020</a>)</span> suggests a non-linear relationship between the sporozoite load <span class="math inline">\(L\)</span> and the transmission efficiency <span class="math inline">\(b\)</span> from mosquito to human. The effect of <span class="math inline">\(\beta\)</span> on <span class="math inline">\(b\)</span> can thus be modelled as so:</p>
<p><span id="eq-TRA"><span class="math display">\[
\frac{f((1 - \beta(t))L)}{f(L)}b
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(b\)</span> is the mosquito-to-human transmission efficiency in absence of malarone and <span class="math inline">\(f\)</span> is the functional relationship between the sporozoite load <span class="math inline">\(L\)</span> and the mosquito-to-human transmission efficiency <span class="math inline">\(b\)</span> documented on Figure 2B of <span class="citation" data-cites="aleshnick_experimental_2020">Aleshnick et al. (<a href="#ref-aleshnick_experimental_2020" role="doc-biblioref">2020</a>)</span> and that we reproduce here:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>make_f <span class="ot">&lt;-</span> <span class="cf">function</span>(x1, x2, y1, y2) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_dbl</span>(x, <span class="cf">function</span>(x) {</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span>(<span class="fu">is.na</span>(x)) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> (x <span class="sc">&lt;</span> x1) <span class="fu">return</span>(x <span class="sc">*</span> y1 <span class="sc">/</span> x1)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                        y1 <span class="sc">+</span> (x <span class="sc">-</span> x1) <span class="sc">*</span> (y2 <span class="sc">-</span> y1) <span class="sc">/</span> (x2 <span class="sc">-</span> x1)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                      })</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">make_f</span>(<span class="at">x1 =</span> <span class="dv">21111</span>, <span class="at">x2 =</span> <span class="fl">1e5</span>, <span class="at">y1 =</span> .<span class="dv">285</span>, <span class="at">y2 =</span> .<span class="dv">344</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And this is what this function <span class="math inline">\(f\)</span> function coded in <code>f()</code> looks like:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>L_val <span class="ot">&lt;-</span> <span class="fu">seq2</span>(<span class="dv">0</span>, <span class="fl">1e5</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotl</span>(L_val, <span class="fu">f</span>(L_val),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">"salivary gland sporozoite load L"</span>, <span class="at">ylab =</span> <span class="st">"infection probability f"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
<p>A tuning of <code>legend2()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>legend3 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend2</span>(<span class="at">title =</span> <span class="st">"sporozoite load L"</span>, <span class="at">col =</span> <span class="fu">rev</span>(YlOrRd10),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend =</span> <span class="fu">c</span>(<span class="fu">bquote</span>(<span class="dv">1</span> <span class="sc">~</span> <span class="st">"x"</span> <span class="sc">~</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">sapply</span>(<span class="dv">9</span><span class="sc">:</span><span class="dv">1</span>, <span class="cf">function</span>(a) <span class="fu">bquote</span>(.(a) <span class="sc">~</span> <span class="st">"x"</span> <span class="sc">~</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>))), ...)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From here, let’s compute the TRA as a function of the (unknown) sporozoite load <span class="math inline">\(L\)</span> using <a href="#eq-TRA" class="quarto-xref">Equation&nbsp;2</a>:</p>
<div class="cell" data-layout-align="center" data-margin4="true">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>beta_val <span class="ot">&lt;-</span> <span class="fu">seq2</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>, <span class="at">xpd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xaxs =</span> <span class="st">"i"</span>, <span class="at">yaxs =</span> <span class="st">"i"</span>, <span class="at">ylab =</span> ylab_b,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">bquote</span>(<span class="st">"reducing factor 1 -"</span> <span class="sc">~</span> beta <span class="sc">~</span> <span class="st">"on sporozoite load L"</span>))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">*</span> <span class="fl">1e4</span>, YlOrRd10,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">lines2</span>(beta_val, <span class="fu">f</span>(beta_val <span class="sc">*</span> .x) <span class="sc">/</span> <span class="fu">f</span>(.x), <span class="at">col =</span> .y))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend3</span>(<span class="st">"topright"</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, <span class="dv">0</span>))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-b_reduction" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-b_reduction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="malarone_files/figure-html/fig-b_reduction-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="614">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-b_reduction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: the conversion of a reduction on the sporozoite load <span class="math inline">\(L\)</span> into a reduction of the mosquito-to-human probability of transmission <span class="math inline">\(b\)</span> and <span class="math inline">\(R_0\)</span> for various (unknown) values of sporozoite load <span class="math inline">\(L\)</span> before ingestion of malarone.
</figcaption>
</figure>
</div>
</div>
</div>
<p>By combining <a href="#fig-beta_data" class="quarto-xref">Figure&nbsp;1</a> and <a href="#fig-b_reduction" class="quarto-xref">Figure&nbsp;2</a> we obtain the reduction factor of <span class="math inline">\(b\)</span> and <span class="math inline">\(R_0\)</span> as a function of time <span class="math inline">\(t\)</span> post drug administration and (unknown) sporozoite load <span class="math inline">\(L\)</span> before malarone ingestion:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NA</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">700</span>), <span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">xlab =</span> xlab_pda, <span class="at">ylab =</span> ylab_b)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">*</span> <span class="fl">1e4</span>, YlOrRd10,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">lines</span>(pda_t, <span class="fu">f</span>((<span class="dv">1</span> <span class="sc">-</span> betas) <span class="sc">*</span> .x) <span class="sc">/</span> <span class="fu">f</span>(.x), <span class="at">col =</span> .y, <span class="at">lwd =</span> lwd_val))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend3</span>(<span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sizes-of-oocysts-at-7dpi" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="sizes-of-oocysts-at-7dpi"><span class="header-section-number">5.3</span> Sizes of oocysts at 7dpi</h3>
<p>Malarone decreases by the multiplicative factor <span class="math inline">\(1 - \gamma\)</span> (<span class="math inline">\(0 \leq \gamma \leq 1\)</span>) the size of oocysts at 7 dpi. Furthermore, figure 5B from <span class="citation" data-cites="werling_steroid_2019">Werling et al. (<a href="#ref-werling_steroid_2019" role="doc-biblioref">2019</a>)</span> suggests a linear relationship between the development time and the oocyst size. By assuming that the EIP corresponds to a given size of the oocysts, we can model the effect of <span class="math inline">\(\gamma\)</span> on <span class="math inline">\(n\)</span> as so:</p>
<p><span class="math display">\[
\frac{1}{1 - \gamma(t)}n
\]</span></p>
<p>With this established, let’s now pull out the data from Figure 5A:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>gamma_data <span class="ot">&lt;-</span> <span class="fu">reading_exp_data</span>(<span class="st">"percentage_inhibition_size2.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and create a function <code>gamma()</code> on the percentage <span class="math inline">\(\gamma(t)\)</span> decrease in oocysts size at 7 dpi as a function of time <span class="math inline">\(t\)</span> post drug administration:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fu">data2function</span>(gamma_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And let’s visualize this function <span class="math inline">\(\gamma(t)\)</span> together with the experimental data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_experimental_data</span>(gamma_data, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">65</span>, .<span class="dv">65</span>),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ylab =</span> <span class="fu">bquote</span>(<span class="st">"sporozoite size reduction factor"</span> <span class="sc">~</span> gamma))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines3</span>(pda_t, <span class="fu">gamma</span>(pda_t))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
<p><strong>Assumption 2:</strong> the EIP corresponds to a given size of the oocysts.</p>
</section>
<section id="combining-the-3-effects" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="combining-the-3-effects"><span class="header-section-number">5.4</span> Combining the 3 effects</h3>
<p>In this section we combine the 3 effects reviewed above into a reduction effect of the basic reproduction ratio <span class="math inline">\(R_0\)</span>. If we assume that all the mosquitoes feed on people who received malarone <span class="math inline">\(t\)</span> time units ago, the reduction factor <span class="math inline">\(\delta(t)\)</span> of <span class="math inline">\(R_0\)</span> reads:</p>
<p><span class="math display">\[
\delta(t, g, n, L) = (1 - \alpha(t))\frac{f((1 - \beta(t))L)}{f(L)}e^{-gn\gamma(t)/(1-\gamma(t))}
\]</span> where <span class="math inline">\(L\)</span> is the mean sporozoite load in absence of malarone. The corresponding R code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="cf">function</span>(t, L, g, n) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">alpha</span>(t)) <span class="sc">*</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>(<span class="sc">-</span> g <span class="sc">*</span> n <span class="sc">*</span> <span class="fu">gamma</span>(t) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">gamma</span>(t))) <span class="sc">*</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">beta</span>(t)) <span class="sc">*</span> L) <span class="sc">/</span> <span class="fu">f</span>(L)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Note 1:</strong> <span class="math inline">\(g\)</span> and <span class="math inline">\(n\)</span> should be expressed in the same time units.<br>
<strong>Note 2:</strong> <span class="math inline">\(t\)</span> should be expressed in hours.</p>
<p>If we now assume that all the mosquitoes feed on people who were treated sometimes during the past <span class="math inline">\(D\)</span> time units, then the mean reduction factor of <span class="math inline">\(R_0\)</span> reads:</p>
<p><span id="eq-lambda"><span class="math display">\[
\lambda(g, n, L, D) = \frac{1}{D}\int_0^D\delta(t, g, n, L)dt
\tag{3}\]</span></span></p>
<p>Ideally, we’d like <span class="math inline">\(D\)</span> to be large enough so that <span class="math inline">\(\delta(t = D, g, n, L)\simeq 0\)</span>. The corresponding R code is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(D, L, g, n, <span class="at">nb =</span> <span class="fl">1e6</span>) {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trapezoid</span>(<span class="cf">function</span>(x) <span class="fu">delta</span>(x, L, g, n), <span class="dv">0</span>, D, nb) <span class="sc">/</span> D</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Note 1:</strong> <span class="math inline">\(g\)</span> and <span class="math inline">\(n\)</span> should be expressed in the same time units.<br>
<strong>Note 2:</strong> <span class="math inline">\(D\)</span> should be expressed in hours.</p>
</section>
</section>
<section id="epidemiological-effects-of-malarone" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="epidemiological-effects-of-malarone"><span class="header-section-number">6</span> Epidemiological effects of malarone</h2>
<p>In this section we use <span class="math inline">\(\lambda\)</span> to develop what interests us here: the mosquito-mediated epidemiological effects of malarone. Since we are interested only in the effect of malarone that is mediated by the mosquito compartment, in what follows we’ll disregard the direct and intended effect of malarone, which is the curation of infected people. We will also consider two types of use of malarone: mass treatment where a given proportion of the population is treated independently of their clinical status and treatment of the infected, which is the way that malarone is currently used. We’ll start however with the mass treatment as it’s the easiest case to model and it will provide us with a gold standard to which to compare the effects of the treatment of infected.</p>
<section id="mass-treatment" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="mass-treatment"><span class="header-section-number">6.1</span> Mass treatment</h3>
<p>Mass treatment is not affected by the epidemiological context so its mosquito-mediated effect <span class="math inline">\(\pi\)</span> can be expresses as:</p>
<p><span class="math display">\[
\pi(\mu, g, n, L, D) = 1 - \left(1 - \min_{\Delta \ge D}\lambda\left(g, n, L, \Delta\right)\right)\mu
\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the proportion of the population that receive the treatment and <span class="math inline">\(1/D\)</span> is the frequency of treatment, assuming an absence of synchrony of treatment intake between people (<em>i.e.</em> the times at which each individual takes its treatment are random). The corresponding R codes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>pi1 <span class="ot">&lt;-</span> <span class="cf">function</span>(D, L, g, n, mu) mu <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">lambda</span>(D, L, g, n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>pi2 <span class="ot">&lt;-</span> <span class="cf">function</span>(lmbd, mu) mu <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> lmbd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given that <span class="math inline">\(\lambda(g, n, L, D)\)</span> is what takes time to compute, it might sometimes be advantageous to use <code>pi2()</code> instead of <code>pi1()</code> (see below).</p>
<p><strong>Note:</strong> <span class="math inline">\(g\)</span> and <span class="math inline">\(n\)</span> should be expressed in the same time units.</p>
</section>
<section id="treatment-of-infected" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="treatment-of-infected"><span class="header-section-number">6.2</span> Treatment of infected</h3>
<p>Finally, let’s put the effect of malarone into an epidemiological context. If <span class="math inline">\(\bar{X}\)</span> is the disease prevalence and <span class="math inline">\(r\)</span> the human recovery rate, then we can approximate the disease incidence by <span class="math inline">\(\bar{X}r\)</span>. If <span class="math inline">\(\tau\)</span> is the treatment coverage (<em>i.e.</em> the proportion of new cases who receive treatment), then the treatment incidence is <span class="math inline">\(\tau\bar{X}r\)</span>. This means that the proportion of people who received treatment sometimes during the past <span class="math inline">\(D\)</span> time units is <span class="math inline">\(1 - e^{-\tau\bar{X}rD}\)</span> and that the mean reduction factor <span class="math inline">\(\rho\)</span> of <span class="math inline">\(R_0\)</span> reads:</p>
<p><span id="eq-rho"><span class="math display">\[
\rho(g, n, L, \tau, \bar{X}, r, D) = 1 - \left(1 - e^{-\tau\bar{X}rD}\right)(1 - \lambda(g, n, L, D))
\tag{4}\]</span></span></p>
<p>The corresponding R codes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>rho1 <span class="ot">&lt;-</span> <span class="cf">function</span>(D, L, g, n, X, tau, r) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span> tau <span class="sc">*</span> X <span class="sc">*</span> r <span class="sc">*</span> D)) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">lambda</span>(D, L, g, n))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>rho2 <span class="ot">&lt;-</span> <span class="cf">function</span>(lmbd, D, X, tau, r) {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span> tau <span class="sc">*</span> X <span class="sc">*</span> r <span class="sc">*</span> D)) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> lmbd)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given that <span class="math inline">\(\lambda(g, n, L, D)\)</span> is what takes time to compute, it might sometimes be advantageous to use <code>rho2()</code> instead of <code>rho1()</code> (see below).</p>
<p><strong>Note 1:</strong> <span class="math inline">\(g\)</span> and <span class="math inline">\(n\)</span> should be expressed in the same time units.<br>
<strong>Note 2:</strong> <span class="math inline">\(r\)</span> and <span class="math inline">\(D\)</span> should be both expressed in hours.</p>
</section>
</section>
<section id="numerical-analysis" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="numerical-analysis"><span class="header-section-number">7</span> Numerical analysis</h2>
<p>The table below lists the parameters of the models, together with their definitions and their values and units:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 47%">
<col style="width: 20%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">parameter</th>
<th style="text-align: left;">definition</th>
<th style="text-align: right;">values</th>
<th style="text-align: right;">unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(g\)</span></td>
<td style="text-align: left;">mosquito death rate</td>
<td style="text-align: right;">1 / 14</td>
<td style="text-align: right;">/day.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(n\)</span></td>
<td style="text-align: left;">extrinsic incubation period (EIP)</td>
<td style="text-align: right;">6, 10 or 14</td>
<td style="text-align: right;">days</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(r\)</span></td>
<td style="text-align: left;">human recovery rate</td>
<td style="text-align: right;">1 / 14</td>
<td style="text-align: right;">/day</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(L\)</span></td>
<td style="text-align: left;">sporozoite load</td>
<td style="text-align: right;">10,000-100,000</td>
<td style="text-align: right;">sporozoites</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(1/D\)</span></td>
<td style="text-align: left;">frequency of treatment intake</td>
<td style="text-align: right;">1/28 - 1</td>
<td style="text-align: right;">/day</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mu\)</span></td>
<td style="text-align: left;">mass treatment coverage</td>
<td style="text-align: right;">0-100</td>
<td style="text-align: right;">%</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\tau\)</span></td>
<td style="text-align: left;">infected treatment coverage</td>
<td style="text-align: right;">0-100</td>
<td style="text-align: right;">%</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\bar{X}\)</span></td>
<td style="text-align: left;">prevalence</td>
<td style="text-align: right;">0-100</td>
<td style="text-align: right;">%</td>
</tr>
</tbody>
</table>
<section id="reducing-factor-deltat" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="reducing-factor-deltat"><span class="header-section-number">7.1</span> Reducing factor <span class="math inline">\(\delta(t)\)</span></h3>
<p>The <span class="math inline">\(R_0\)</span> reducing factor <span class="math inline">\(\rho(t)\)</span> is computed by assuming that all the mosquitoes feed on people <span class="math inline">\(t\)</span> hours after drug administration. For a mosquito life expectancy <span class="math inline">\(1/g\)</span> of 14 days, an EPI <span class="math inline">\(n\)</span> of 7 days, a sporozoite load of 60,000, if the all the mosquitoes feed on people 100 hours after drug administration, the <span class="math inline">\(R_0\)</span> reducing factor <span class="math inline">\(\delta\)</span> is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(effect_at_t100 <span class="ot">&lt;-</span> <span class="fu">delta</span>(<span class="at">t =</span> <span class="dv">100</span>, <span class="at">L =</span> <span class="fl">6e4</span>, <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">14</span>, <span class="at">n =</span> <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2560804</code></pre>
</div>
</div>
<p>More generally, if all the mosquitoes feed on people <span class="math inline">\(t\)</span> hours after drug administration, the <span class="math inline">\(R_0\)</span> reducing factor looks like:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pda_t2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span> <span class="sc">*</span> <span class="dv">28</span>, <span class="at">le =</span> <span class="dv">2</span><span class="sc">^</span><span class="dv">10</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ys <span class="ot">&lt;-</span> <span class="fu">delta</span>(<span class="at">t =</span> pda_t2, <span class="at">L =</span> <span class="fl">6e4</span>, <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">14</span> <span class="sc">*</span> <span class="dv">24</span>), <span class="at">n =</span> <span class="dv">7</span> <span class="sc">*</span> <span class="dv">24</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotl</span>(pda_t2, ys, <span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">xlab =</span> xlab_pda, <span class="at">ylab =</span> ylab_delta)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">100</span>, <span class="at">col =</span> <span class="dv">4</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> effect_at_t100, <span class="at">col =</span> <span class="dv">4</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">100</span>, effect_at_t100, <span class="at">col =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
<p>where the blue point and lines show the case where all the mosquitoes feed on people 100 hours after drug administration. Let’s now look at the effect of the value of <span class="math inline">\(L\)</span> on this curve:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NA</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">700</span>), <span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">xlab =</span> xlab_pda, <span class="at">ylab =</span> ylab_delta)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">*</span> <span class="fl">1e4</span>, YlOrRd10,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">lines</span>(pda_t, <span class="fu">delta</span>(<span class="at">t =</span> pda_t, <span class="at">L =</span> .x, <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">14</span> <span class="sc">*</span> <span class="dv">24</span>), <span class="at">n =</span> <span class="dv">7</span> <span class="sc">*</span> <span class="dv">24</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> .y, <span class="at">lwd =</span> lwd_val))</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend3</span>(<span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mass-treatment-1" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="mass-treatment-1"><span class="header-section-number">7.2</span> Mass treatment</h3>
<p>The <span class="math inline">\(R_0\)</span> reducing factor <span class="math inline">\(\lambda(t)\)</span> is computed by assuming that all the mosquitoes feed on people that were treated sometimes during the past <span class="math inline">\(D\)</span> time units. Considering that all the mosquitoes feed of people who received treatment in the past 28 days, the <span class="math inline">\(R_0\)</span> reducing factor <span class="math inline">\(\lambda\)</span> is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>(mean_effect_over28days <span class="ot">&lt;-</span> <span class="fu">lambda</span>(<span class="at">D =</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>, <span class="at">L =</span> <span class="fl">6e4</span>, <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">14</span>, <span class="at">n =</span> <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(takes ca 1.5” ) which, on the previous plot, looks like:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pda_t2, ys, <span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">xaxs =</span> <span class="st">"i"</span>, <span class="at">yaxs =</span> <span class="st">"i"</span>, <span class="at">type =</span> <span class="st">"n"</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> xlab_pda, <span class="at">ylab =</span> ylab_delta)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(pda_t2[<span class="dv">1</span>], pda_t2, <span class="fu">tail</span>(pda_t2, <span class="dv">1</span>)), <span class="fu">c</span>(<span class="dv">0</span>, ys, <span class="dv">0</span>),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="dv">4</span>, .<span class="dv">2</span>))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines3</span>(pda_t2, ys)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> mean_effect_over28days, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> lwd_val)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">mean</span>(pda_t2), <span class="fl">1.04</span> <span class="sc">*</span> mean_effect_over28days, <span class="at">col =</span> <span class="dv">4</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">bquote</span>(<span class="st">"        mean"</span> <span class="sc">~</span> R[<span class="dv">0</span>] <span class="sc">~</span> <span class="st">"reduction factor"</span> <span class="sc">~</span> lambda))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="537"></p>
</figure>
</div>
</div>
</div>
<p>A function that computes the values for <span class="math inline">\(\lambda\)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>compute_lambda_val <span class="ot">&lt;-</span> <span class="cf">function</span>(D_val, n_val, L_val, g) {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">expand.grid</span>(n_val, L_val),</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">map2</span>(Var1, Var2, <span class="sc">~</span> <span class="fu">map_dbl</span>(D_val, lambda, <span class="at">L =</span> .y, <span class="at">g =</span> g, <span class="at">n =</span> .x)))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(out, <span class="st">"params"</span>) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">D_val =</span> D_val, <span class="at">n_val =</span> n_val, <span class="at">L_val =</span> L_val, <span class="at">g =</span> g)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now compute <span class="math inline">\(\lambda\)</span> values (takes ca 7’00”):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>lambda_vals <span class="ot">&lt;-</span> <span class="fu">compute_lambda_val</span>(<span class="at">D_val =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">7</span>, .<span class="dv">1</span>), <span class="dv">8</span><span class="sc">:</span><span class="dv">28</span>) <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_val =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">14</span>),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">L_val =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>) <span class="sc">*</span> <span class="fl">1e4</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(takes ca 19’00”):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>lambda_vals2 <span class="ot">&lt;-</span> <span class="fu">compute_lambda_val</span>(<span class="at">D_val =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">7</span>, .<span class="dv">1</span>), <span class="dv">8</span><span class="sc">:</span><span class="dv">28</span>) <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">n_val =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">14</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">L_val =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>) <span class="sc">*</span> <span class="fl">1e4</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(takes ca 19’00”):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>lambda_vals3 <span class="ot">&lt;-</span> <span class="fu">compute_lambda_val</span>(<span class="at">D_val =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">7</span>, .<span class="dv">1</span>), <span class="dv">8</span><span class="sc">:</span><span class="dv">28</span>) <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">n_val =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">14</span>),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">L_val =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>) <span class="sc">*</span> <span class="fl">1e4</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A function that plots the effect of mass treatment:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>xmax <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>plot_mass_treatment <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">x_axis =</span> <span class="cn">TRUE</span>, <span class="at">y_axis =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">xlab =</span> <span class="st">"intake frequency (every D days)"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ylab =</span> ylab_pi,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">hlines =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">1</span>), <span class="at">transform =</span> <span class="dv">1</span>) {</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">rev</span>(x), y, <span class="at">xlim =</span> <span class="fu">c</span>(xmax, <span class="dv">0</span>), <span class="at">ylim =</span> ylim, <span class="at">type =</span> <span class="st">"n"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> ylab, <span class="at">xaxs =</span> <span class="st">"i"</span>, <span class="at">yaxs =</span> <span class="st">"i"</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x_axis) {<span class="fu">axis</span>(<span class="dv">1</span>, <span class="fu">seq</span>(<span class="dv">0</span>, xmax, <span class="dv">5</span>)); <span class="fu">axis</span>(<span class="dv">1</span>, <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">25</span>))}</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y_axis) <span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">seq</span>(<span class="dv">0</span>, xmax, <span class="dv">5</span>), <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> hlines, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk2</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">1</span>), YlOrRd11,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span> <span class="fu">lines</span>(<span class="fu">rev</span>(x), <span class="fu">rev</span>((<span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">min_of_following</span>(y)) <span class="sc">*</span> .x) <span class="sc">*</span> transform),</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> .y, <span class="at">lwd =</span> lwd_val))</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some <code>mtext()</code> tuning for the multipanel figures:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mtext2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"EPI ="</span>, x, <span class="st">"days"</span>), <span class="dv">3</span>, .<span class="dv">5</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>mtext3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"L ="</span>, <span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">FALSE</span>, <span class="at">big.mark =</span> <span class="st">","</span>)), <span class="dv">4</span>, .<span class="dv">75</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A tuning of <code>legend()</code> for the multipanel figures:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>legend4 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> lwd_val, <span class="at">adj =</span> <span class="fu">c</span>(<span class="dv">1</span>, .<span class="dv">5</span>), <span class="at">x.intersp =</span> <span class="dv">4</span>, ...)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>legend5 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend4</span>(<span class="at">col =</span> YlOrRd11, <span class="at">inset =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">25</span>, <span class="sc">-</span>.<span class="dv">23</span>), ...)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">FALSE</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function that uses <code>plot_mass_treatment()</code> to make a multipanel figure using the output of <code>compute_lambda_val()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>multipanels_mass <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda_vals, <span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ylab =</span> ylab_pi,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">hlines =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">1</span>), <span class="at">R0o =</span> <span class="cn">NULL</span>) {</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">attr</span>(lambda_vals, <span class="st">"params"</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(R0o)) {</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    trnsfrm <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    trnsfrm <span class="ot">&lt;-</span> <span class="fu">with</span>(params, R0o <span class="sc">*</span> <span class="fu">exp</span>(<span class="dv">1</span> <span class="sc">-</span> g <span class="sc">*</span> n_val))</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  plot_mass_treatment2 <span class="ot">&lt;-</span> <span class="cf">function</span>(y, <span class="at">ylob =</span> ylab, ...) {</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_mass_treatment</span>(params<span class="sc">$</span>D_val <span class="sc">/</span> <span class="dv">24</span>, y, <span class="at">ylim =</span> ylim, <span class="at">ylab =</span> ylob,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">hlines =</span> hlines, ...)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  plot_mass_treatment3 <span class="ot">&lt;-</span> <span class="cf">function</span>(y, ...) {</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_mass_treatment2</span>(y, <span class="at">xlab =</span> <span class="cn">NA</span>, <span class="at">x_axis =</span> <span class="cn">FALSE</span>, ...)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  plot_mass_treatment4 <span class="ot">&lt;-</span> <span class="cf">function</span>(y, ...) {</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_mass_treatment2</span>(y, <span class="at">ylob =</span> <span class="cn">NA</span>, <span class="at">y_axis =</span> <span class="cn">FALSE</span>, ...)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>  plot_mass_treatment5 <span class="ot">&lt;-</span> <span class="cf">function</span>(y, ...) {</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_mass_treatment4</span>(y, <span class="at">xlab =</span> <span class="cn">NA</span>, <span class="at">x_axis =</span> <span class="cn">FALSE</span>, ...)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>  opar <span class="ot">&lt;-</span> <span class="fu">parmfrow33</span>()</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_mass_treatment3</span>(lambda_vals[[<span class="dv">7</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">1</span>])</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext2</span>(params<span class="sc">$</span>n_val[<span class="dv">1</span>])</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_mass_treatment5</span>(lambda_vals[[<span class="dv">8</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">2</span>])</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext2</span>(params<span class="sc">$</span>n_val[<span class="dv">2</span>])</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend5</span>(<span class="st">"bottomleft"</span>, <span class="at">title =</span> <span class="st">"proportion treated"</span>, <span class="at">text.width =</span> .<span class="dv">5</span>, </span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="fu">paste</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">10</span>), <span class="st">"%"</span>))</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_mass_treatment5</span>(lambda_vals[[<span class="dv">9</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">3</span>])</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext2</span>(params<span class="sc">$</span>n_val[<span class="dv">3</span>])</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext3</span>(params<span class="sc">$</span>L_val[<span class="dv">3</span>])</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_mass_treatment3</span>(lambda_vals[[<span class="dv">4</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">1</span>])</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_mass_treatment5</span>(lambda_vals[[<span class="dv">5</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">2</span>])</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_mass_treatment5</span>(lambda_vals[[<span class="dv">6</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">3</span>])</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext3</span>(params<span class="sc">$</span>L_val[<span class="dv">2</span>])</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_mass_treatment2</span>(lambda_vals[[<span class="dv">1</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">1</span>])</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_mass_treatment4</span>(lambda_vals[[<span class="dv">2</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">2</span>])</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_mass_treatment4</span>(lambda_vals[[<span class="dv">3</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">3</span>])</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext3</span>(params<span class="sc">$</span>L_val[<span class="dv">1</span>])</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(opar)</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_mass</span>(lambda_vals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_mass</span>(lambda_vals2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_mass</span>(lambda_vals3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="treatment-of-infected-1" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="treatment-of-infected-1"><span class="header-section-number">7.3</span> Treatment of infected</h3>
<p>If we take the example of the previous section and put it into an epidemiological context of a prevalence of 10% and assuming that 90% of the people infected are given a treatment, the <span class="math inline">\(R_0\)</span> reducing factor <span class="math inline">\(\rho\)</span> is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rho1</span>(<span class="at">D =</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>, <span class="at">L =</span> <span class="fl">6e4</span>, <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">14</span>, <span class="at">n =</span> <span class="dv">7</span>, <span class="at">X =</span> .<span class="dv">1</span>, <span class="at">tau =</span> .<span class="dv">9</span>, <span class="at">r =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">14</span> <span class="sc">*</span> <span class="dv">24</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(which takes 1.5”). Alternatively (and faster):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rho2</span>(mean_effect_over28days, <span class="at">D =</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>, <span class="at">X =</span> .<span class="dv">1</span>, <span class="at">tau =</span> .<span class="dv">9</span>, <span class="at">r =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">14</span> <span class="sc">*</span> <span class="dv">24</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9656542</code></pre>
</div>
</div>
<p>A function that computes the values for <span class="math inline">\(\rho\)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>compute_rho_val <span class="ot">&lt;-</span> <span class="cf">function</span>(X_val, tau_val, n_val, L_val, D, g, r, nb) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  one_subplot <span class="ot">&lt;-</span> <span class="cf">function</span>(n, L) { <span class="co"># i.e. for given values of n and L</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    lambda_val <span class="ot">&lt;-</span> <span class="fu">lambda</span>(D, L, g, n, nb)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand.grid</span>(X_val, tau_val) <span class="sc">|&gt;</span> </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">with</span>(<span class="fu">map2_dbl</span>(Var1, Var2, rho2, <span class="at">lmbd =</span> lambda_val, <span class="at">D =</span> D, <span class="at">r =</span> r)) <span class="sc">|&gt;</span> </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">length</span>(X_val)) <span class="sc">|&gt;</span> <span class="fu">t</span>() <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">expand.grid</span>(n_val, L_val), <span class="fu">map2</span>(Var1, Var2, one_subplot))</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attr</span>(out, <span class="st">"params"</span>) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">X_val =</span> X_val, <span class="at">tau_val =</span> tau_val, <span class="at">n_val =</span> n_val,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">L_val =</span> L_val, <span class="at">D =</span> D, <span class="at">g =</span> g, <span class="at">r =</span> r, <span class="at">nb =</span> nb)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A function that plots the computed <span class="math inline">\(\rho\)</span> values as a function of the proportion <span class="math inline">\(\tau\)</span> of infected people that are treated (i.e.&nbsp;one slot of the output of <code>compute_rho_val()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>abline3 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">abline</span>(..., <span class="at">col =</span> <span class="st">"lightgrey"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>abline4 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">abline3</span>(..., <span class="at">lwd =</span> lwd_val)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>plot_treatment_infected <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">x_axis =</span> <span class="cn">TRUE</span>, <span class="at">y_axis =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">xlab =</span> <span class="fu">bquote</span>(<span class="st">"proportion"</span> <span class="sc">~</span> tau <span class="sc">~</span> <span class="st">"treated"</span>),</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">ylab =</span> ylab_rho,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">hlines1 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">1</span>), <span class="at">hlines2 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">05</span>),</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">transform =</span> <span class="dv">1</span>) {</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="cn">NA</span>, <span class="at">xlim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">ylim =</span> ylim, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xaxs =</span> <span class="st">"i"</span>, <span class="at">yaxs =</span> <span class="st">"i"</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> xlab, <span class="at">ylab =</span> ylab)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x_axis) <span class="fu">axis</span>(<span class="dv">1</span>)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y_axis) <span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline3</span>(<span class="at">v =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">05</span>))</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline4</span>(<span class="at">v =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">1</span>))</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline4</span>(<span class="at">h =</span> hlines1)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline3</span>(<span class="at">h =</span> hlines2)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk2</span>(y, YlOrRd11, <span class="sc">~</span> <span class="fu">lines</span>(x, .x <span class="sc">*</span> transform, <span class="at">col =</span> .y, <span class="at">lwd =</span> lwd_val))</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s compute some <span class="math inline">\(\rho\)</span> values (it takes 15”):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>rho_val1 <span class="ot">&lt;-</span> <span class="fu">compute_rho_val</span>(<span class="at">X_val =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">1</span>),</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">tau_val =</span> <span class="fu">seq2</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">n_val =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">14</span>),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">L_val =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>) <span class="sc">*</span> <span class="fl">1e4</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">D =</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">14</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">r =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">14</span> <span class="sc">*</span> <span class="dv">24</span>),</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nb =</span> <span class="fl">1e6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(it takes 15”):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>rho_val2 <span class="ot">&lt;-</span> <span class="fu">compute_rho_val</span>(<span class="at">X_val =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">1</span>),</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">tau_val =</span> <span class="fu">seq2</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">n_val =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">14</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">L_val =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>) <span class="sc">*</span> <span class="fl">1e4</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">D =</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">r =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">14</span> <span class="sc">*</span> <span class="dv">24</span>),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nb =</span> <span class="fl">1e6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(it takes 15”):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>rho_val3 <span class="ot">&lt;-</span> <span class="fu">compute_rho_val</span>(<span class="at">X_val =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">1</span>),</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">tau_val =</span> <span class="fu">seq2</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">n_val =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">14</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">L_val =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>) <span class="sc">*</span> <span class="fl">1e4</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">D =</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">g =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">7</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">r =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">14</span> <span class="sc">*</span> <span class="dv">24</span>),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nb =</span> <span class="fl">1e6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function that uses <code>plot_treatment_infected()</code> to make a multipanel figure using the output of <code>compute_rho_val()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>multipanels_infected <span class="ot">&lt;-</span> <span class="cf">function</span>(rho_val, <span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ylab =</span> ylab_rho,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">hlines1 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">1</span>), <span class="at">hlines2 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">05</span>),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">R0o =</span> <span class="cn">NULL</span>) {</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">attr</span>(rho_val, <span class="st">"params"</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(R0o)) {</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    trnsfrm <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    trnsfrm <span class="ot">&lt;-</span> <span class="fu">with</span>(params, R0o <span class="sc">*</span> <span class="fu">exp</span>(<span class="dv">1</span> <span class="sc">-</span> g <span class="sc">*</span> n_val))</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  plot_treatment_infected2 <span class="ot">&lt;-</span> <span class="cf">function</span>(y, <span class="at">ylob =</span> ylab, ...) {</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_treatment_infected</span>(params<span class="sc">$</span>tau_val, y, <span class="at">ylim =</span> ylim, <span class="at">ylab =</span> ylob,</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">hlines1 =</span> hlines1, <span class="at">hlines2 =</span> hlines2, ...)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  plot_treatment_infected3 <span class="ot">&lt;-</span> <span class="cf">function</span>(y, ...) {</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_treatment_infected2</span>(y, <span class="at">xlab =</span> <span class="cn">NA</span>, <span class="at">x_axis =</span> <span class="cn">FALSE</span>, ...)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>  plot_treatment_infected4 <span class="ot">&lt;-</span> <span class="cf">function</span>(y, ...) {</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_treatment_infected2</span>(y, <span class="at">ylob =</span> <span class="cn">NA</span>, <span class="at">y_axis =</span> <span class="cn">FALSE</span>, ...)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>  plot_treatment_infected5 <span class="ot">&lt;-</span> <span class="cf">function</span>(y, ...) {</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_treatment_infected4</span>(y, <span class="at">xlab =</span> <span class="cn">NA</span>, <span class="at">x_axis =</span> <span class="cn">FALSE</span>, ...)</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>  op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="at">mex =</span> mcx, <span class="at">cex.axis =</span> mcx, <span class="at">cex.lab =</span> mcx, <span class="at">cex.main =</span> mcx)</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_treatment_infected3</span>(rho_val[[<span class="dv">7</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">1</span>])</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext2</span>(params<span class="sc">$</span>n_val[<span class="dv">1</span>])</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_treatment_infected5</span>(rho_val[[<span class="dv">8</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">2</span>])</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext2</span>(params<span class="sc">$</span>n_val[<span class="dv">2</span>])</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend5</span>(<span class="st">"bottomleft"</span>, <span class="at">title =</span> <span class="st">"prevalence"</span>, <span class="at">text.width =</span> <span class="dv">0</span>, </span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="fu">paste</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">10</span>), <span class="st">"%"</span>))</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_treatment_infected5</span>(rho_val[[<span class="dv">9</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">3</span>])</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext2</span>(params<span class="sc">$</span>n_val[<span class="dv">3</span>])</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext3</span>(params<span class="sc">$</span>L_val[<span class="dv">3</span>])</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_treatment_infected3</span>(rho_val[[<span class="dv">4</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">1</span>])</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_treatment_infected5</span>(rho_val[[<span class="dv">5</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">2</span>])</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_treatment_infected5</span>(rho_val[[<span class="dv">6</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">3</span>])</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext3</span>(params<span class="sc">$</span>L_val[<span class="dv">2</span>])</span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_treatment_infected2</span>(rho_val[[<span class="dv">1</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">1</span>])</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_treatment_infected4</span>(rho_val[[<span class="dv">2</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">2</span>])</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_treatment_infected4</span>(rho_val[[<span class="dv">3</span>]], <span class="at">transf =</span> trnsfrm[<span class="dv">3</span>])</span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext3</span>(params<span class="sc">$</span>L_val[<span class="dv">1</span>])</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(op)</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_infected</span>(rho_val1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_infected</span>(rho_val2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_infected</span>(rho_val3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="examples-with-r_0" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="examples-with-r_0"><span class="header-section-number">7.4</span> Examples with <span class="math inline">\(R_0\)</span></h3>
<p>If we want to look at a specific example of <span class="math inline">\(R_0\)</span>, we need to acknowledge that, everything else being constant, <span class="math inline">\(R_0\)</span> is proportional to the probability <span class="math inline">\(P_e\)</span> of an infected mosquito to become infectious:</p>
<p><span class="math display">\[
R_0 \propto e^{-gn}
\]</span></p>
<p>with this being considered, let’s now consider for example a reference value of <span class="math inline">\(R_0 = 5\)</span> in absence of treatment and when the EPI <span class="math inline">\(n\)</span> is equal to the mosquito life expectancy <span class="math inline">\(1/g = 14\)</span> days. The effect of mass treatment would look like:</p>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_mass</span>(lambda_vals, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, ymax),</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylab =</span> <span class="fu">bquote</span>(R[<span class="dv">0</span>]), <span class="at">hlines =</span> <span class="dv">0</span><span class="sc">:</span>ymax, <span class="at">R0o =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_mass</span>(lambda_vals2, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, ymax),</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylab =</span> <span class="fu">bquote</span>(R[<span class="dv">0</span>]), <span class="at">hlines =</span> <span class="dv">0</span><span class="sc">:</span>ymax, <span class="at">R0o =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_mass</span>(lambda_vals3, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, ymax),</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylab =</span> <span class="fu">bquote</span>(R[<span class="dv">0</span>]), <span class="at">hlines =</span> <span class="dv">0</span><span class="sc">:</span>ymax, <span class="at">R0o =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>And the effect of the treatment of the infected would look like:</p>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_infected</span>(rho_val1, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, ymax), <span class="at">ylab =</span> <span class="fu">bquote</span>(R[<span class="dv">0</span>]),</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hlines1 =</span> <span class="dv">0</span><span class="sc">:</span>ymax, <span class="at">hlines2 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, ymax, .<span class="dv">5</span>), <span class="at">R0o =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_infected</span>(rho_val2, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, ymax), <span class="at">ylab =</span> <span class="fu">bquote</span>(R[<span class="dv">0</span>]),</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hlines1 =</span> <span class="dv">0</span><span class="sc">:</span>ymax, <span class="at">hlines2 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, ymax, .<span class="dv">5</span>), <span class="at">R0o =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-margin3c="true">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">multipanels_infected</span>(rho_val3, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, ymax), <span class="at">ylab =</span> <span class="fu">bquote</span>(R[<span class="dv">0</span>]),</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hlines1 =</span> <span class="dv">0</span><span class="sc">:</span>ymax, <span class="at">hlines2 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, ymax, .<span class="dv">5</span>), <span class="at">R0o =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="main-text-figure" class="level3" data-number="7.5">
<h3 data-number="7.5" class="anchored" data-anchor-id="main-text-figure"><span class="header-section-number">7.5</span> Main text figure</h3>
<p>This is the figure that shows the mass treatment and the treatment of infected for <span class="math inline">\(L = 50,000\)</span> and <span class="math inline">\(n = 10\)</span> days:</p>
<div class="cell" data-layout-align="center" data-margin5="true">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>mtext4 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">mtext</span>(..., <span class="at">line =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">font =</span> <span class="dv">2</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>at_val <span class="ot">&lt;-</span> <span class="fl">4.7</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>xmax <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>leg <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">10</span>), <span class="st">"%"</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>nb_mid <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mass_treatment</span>(<span class="fu">attr</span>(lambda_vals, <span class="st">"params"</span>)<span class="sc">$</span>D_val <span class="sc">/</span> <span class="dv">24</span>, lambda_vals[[<span class="dv">5</span>]])</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend4</span>(<span class="st">"bottomleft"</span>, <span class="at">title =</span> <span class="st">"proportion treated"</span>, <span class="at">text.width =</span> .<span class="dv">5</span>,</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(YlOrRd11[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="fu">rep</span>(<span class="st">"#FFFFFF"</span>, nb_mid), YlOrRd11[<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>]), </span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span> <span class="fu">c</span>(leg[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="fu">rep</span>(<span class="st">"."</span>, nb_mid), leg[<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>]))</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext4</span>(<span class="st">"a"</span>, <span class="at">at =</span> at_val <span class="sc">+</span> xmax)</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_treatment_infected</span>(<span class="fu">attr</span>(rho_val1, <span class="st">"params"</span>)<span class="sc">$</span>tau, rho_val1[[<span class="dv">5</span>]])</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="fu">legend4</span>(<span class="st">"bottomleft"</span>, <span class="at">title =</span> <span class="st">"prevalence"</span>, <span class="at">col =</span> YlOrRd11, <span class="at">text.width =</span> <span class="dv">0</span>,</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span> leg)</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext4</span>(<span class="st">"b"</span>, <span class="at">at =</span> <span class="sc">-</span> at_val <span class="sc">/</span> xmax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-margin5="true">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mtext4 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">mtext</span>(..., <span class="at">line =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">font =</span> <span class="dv">2</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>at_val <span class="ot">&lt;-</span> <span class="fl">4.7</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>xmax <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>leg <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">10</span>), <span class="st">"%"</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>nb_mid <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_treatment_infected</span>(<span class="fu">attr</span>(rho_val1, <span class="st">"params"</span>)<span class="sc">$</span>tau, rho_val1[[<span class="dv">5</span>]])</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend4</span>(<span class="st">"bottomleft"</span>, <span class="at">title =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"prevalence "</span>, <span class="fu">bar</span>(X))),</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> YlOrRd11, <span class="at">text.width =</span> <span class="dv">0</span>, <span class="at">legend =</span> leg)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext4</span>(<span class="st">"a"</span>, <span class="at">at =</span> <span class="sc">-</span> at_val <span class="sc">/</span> xmax)</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mass_treatment</span>(<span class="fu">attr</span>(lambda_vals, <span class="st">"params"</span>)<span class="sc">$</span>D_val <span class="sc">/</span> <span class="dv">24</span>, lambda_vals[[<span class="dv">5</span>]])</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="fu">legend4</span>(<span class="st">"bottomleft"</span>, <span class="at">title =</span> <span class="st">"proportion treated"</span>, <span class="at">text.width =</span> .<span class="dv">5</span>,</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(YlOrRd11[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="fu">rep</span>(<span class="st">"#FFFFFF"</span>, nb_mid), YlOrRd11[<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>]), </span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span> <span class="fu">c</span>(leg[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="fu">rep</span>(<span class="st">"."</span>, nb_mid), leg[<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>]))</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext4</span>(<span class="st">"b"</span>, <span class="at">at =</span> at_val <span class="sc">+</span> xmax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malarone_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-aleshnick_experimental_2020" class="csl-entry" role="listitem">
Aleshnick, M., V. V. Ganusov, G. Nasir, G. Yenokyan, and P. Sinnis. 2020. <a href="https://doi.org/10.1371/journal.ppat.1008181">Experimental determination of the force of malaria infection reveals a non-linear relationship to mosquito sporozoite loads</a>. PLoS Pathog 16:e1008181.
</div>
<div id="ref-saul_cyclical_1990" class="csl-entry" role="listitem">
Saul, A. J., P. M. Graves, and B. H. Kay. 1990. <a href="https://doi.org/10.2307/2403572">A cyclical feeding model for pathogen transmission and its application to determine vectorial capacity from vector infection rates</a>. J Appl Ecol 27:123.
</div>
<div id="ref-smith_statics_2004" class="csl-entry" role="listitem">
Smith, D. L., and E. F. McKenzie. 2004. <a href="https://doi.org/10.1186/1475-2875-3-13">Statics and dynamics of malaria infection in <em><span>A</span>nopheles</em> mosquitoes</a>. Malar J 3:13.
</div>
<div id="ref-werling_steroid_2019" class="csl-entry" role="listitem">
Werling, K., W. R. Shaw, M. A. Itoe, K. A. Westervelt, P. Marcenac, D. G. Paton, D. Peng, et al. 2019. <a href="https://doi.org/10.1016/j.cell.2019.02.036">Steroid hormone function controls non-competitive <em><span>P</span>lasmodium</em> development in <em><span>A</span>nopheles</em></a>. Cell 177:315–325.e14.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>